<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src/site/markdown/abscripting.md
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Language" content="en" />
    <title>PokerFace &#x2013; </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>PokerFace <(◕___◕)></h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="downloads.html" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="https://www.github.com/pcafstockf/PokerFace" class="externalLink" title="Source Code"><span class="none"></span>Source Code</a></li>
    <li><a href="benchmarks.html" title="Benchmarks"><span class="none"></span>Benchmarks</a></li>
    <li><a href="overview-dev.html" title="Dev Guide"><span class="none"></span>Dev Guide</a></li>
    <li><a href="apidocs/index.html" title="Java Doc"><span class="none"></span>Java Doc</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://www.bytelightning.com/" title="Foo" class="builtBy"><img class="builtBy"  alt="Foo" src="powered-by.png"    /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<p>PokerFace scripting can be used for sophisticated <a class="externalLink" href="http://en.wikipedia.org/wiki/A/B_testing">A/B testing</a>.</p>
<div class="section">
<div class="section">
<h3><a name="Setup"></a>Setup</h3>
<p>You will need to review the <a href="./servletscripting.html">scripting documentation</a> to fully understand how to use scripts, but for now let&#x2019;s focus on the highlights.</p></div>
<div class="section">
<h3><a name="Approach"></a>Approach</h3>
<p>We will start with a trivial example of serving an existing html layout to half our visitors, and a new html test layout to the other half.</p>
<p>Every transaction has a unique id number, and for this example we will use it to serve the existing layout on every even numbered transaction id and the new layout on every odd numbered transaction id.</p>
<p>All scripts must implement the <tt>inspectRequest</tt> method, which recieves the client&#x2019;s <a class="externalLink" href="http://hc.apache.org/httpcomponents-core-4.3.x/httpcore/apidocs/org/apache/http/HttpRequest.html">request</a>, and the <a class="externalLink" href="http://hc.apache.org/httpcomponents-core-4.3.x/httpcore/apidocs/org/apache/http/protocol/HttpContext.html">context</a> of the http transaction.  The transaction id is stored as a string in the <tt>context</tt> and can be accessed with <tt>context.getAttribute('pokerface.txId')</tt>.</p>
<p>The <tt>inspectRequest</tt> method is allowed to return many differnt types of values.  If it returns a string, PokerFace interprets this as a url to be proxied from a remote server.</p>
<p>The complete script for our A/B example is simply:</p>

<div>
<div>
<pre class="source">(function() {
	return {
		apiVersion: 1,
		
		inspectRequest: function(request, context) {
			var id = parseInt(context.getAttribute('pokerface.txId'));
			if (id &amp; 1)
				return '/marketing/new-index.html';
			return '/marketing/index.html';	
		}
	};
})();
</pre></div></div>

<p>The <a class="externalLink" href="http://hc.apache.org/httpcomponents-core-4.3.x/httpcore/apidocs/org/apache/http/HttpRequest.html">request</a> object contains the request url as well as the HTTP request headers.  This would enable you to extract cookie, session, eTag, or other information to identify the user and determine which page to serve.</p></div>
<div class="section">
<h3><a name="Summary"></a>Summary</h3>
<p>To gain a better understanding of PokerFace scripts you will need to read through the <a href="./servletscripting.html">&#x2018;Hello World&#x2019;</a> example, but as you can see scripts can be both powerful and simple.</p></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p class="pull-right">Copyright &copy;2015&#x2013;2019
Frank Stock.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
