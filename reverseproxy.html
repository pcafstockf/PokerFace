<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src/site/markdown/reverseproxy.md
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Language" content="en" />
    <title>PokerFace &#x2013; </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>PokerFace <(◕___◕)></h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="downloads.html" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="https://www.github.com/pcafstockf/PokerFace" class="externalLink" title="Source Code"><span class="none"></span>Source Code</a></li>
    <li><a href="benchmarks.html" title="Benchmarks"><span class="none"></span>Benchmarks</a></li>
    <li><a href="overview-dev.html" title="Dev Guide"><span class="none"></span>Dev Guide</a></li>
    <li><a href="apidocs/index.html" title="Java Doc"><span class="none"></span>Java Doc</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://www.bytelightning.com/" title="Foo" class="builtBy"><img class="builtBy"  alt="Foo" src="powered-by.png"    /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<p><b>PokerFace</b> has simple but powerful reverse proxy capabilities.  Being built on top of the Apache HttpComponents NIO library, PokerFace can rapidly handle large numbers of simultaneous connections with very low resource requirements.</p>
<div class="section">
<div class="section">
<h3><a name="Setup"></a>Setup</h3>
<p>To get everything setup, let&#x2019;s walk through a simple reverse proxy from your own machine to our good friends over at Stack Overflow.</p>
<ul>

<li>You will need to have <a class="externalLink" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 8</a> or greater installed on your machine.</li>
<li>If you don&#x2019;t have it already, <a href="./downloads.html">download</a> the latest PokerFace-0.9.4.jar file.</li>
<li>Create a local directory structure that looks like this:</li>
</ul>

<div>
<div>
<pre class="source">my-test-dir  		(you can name this whatever you want)
 | PokerFace-0.9.4.jar  (the latest version from the download link above)
</pre></div></div>

<ul>

<li>Open a command prompt and type <tt>java -version</tt> to ensure you are running Java 8 or greater.</li>
<li>Change into &#x2018;my-test-dir&#x2019; and launch PokerFace with the command:</li>
</ul>

<div>
<div>
<pre class="source">java -jar PokerFace-0.9.4.jar -listen 127.0.0.1:8080 -target &quot;/*=http://stackoverflow.com&quot;
</pre></div></div>

<p>This tells PokerFace to listen for http connections on localhost port 8080 and to forward all requests over to Stack Overflow.  You can test this by browsing to <a class="externalLink" href="http://localhost:8080/">http://localhost:8080/</a>.  Note that it is the Stack Overflow website, but the url is your own machine.  This is a reverse proxy in it&#x2019;s simplest form.</p></div>
<div class="section">
<h3><a name="Basic_Reverse_Proxy"></a>Basic Reverse Proxy</h3>
<p>Let&#x2019;s look at a slightly more realistic reverse proxy configuration that will also illustrates the infamous <b>DocumentRoot</b> challenge (which you must be aware of when configuring any reverse proxy):</p>

<div>
<div>
<pre class="source">java -jar PokerFace-0.9.4.jar -listen http=0.0.0.0:8080 -target &quot;/public/*=http://new-hotness.mydomain.com&quot; -target &quot;/private/*=http://old-and-busted.mydomain.com/corp#8&quot;
</pre></div></div>

<p>This would tell PokerFace to listen for http connections to port 8080 on all interfaces. Requests beginning with <tt>/public/</tt> will be proxied to the server at <tt>new-hotness.mydomain.com</tt>. Requests beginning with <tt>/private/</tt> will be sent to the <tt>old-and-busted.mydomain.com</tt> server. All other requests will return a <tt>404</tt> (NOT_FOUND).</p>
<div class="section">
<h4><a name="new-hotness"></a>new-hotness</h4>
<p>Assuming your machine is &#x2018;my-machine&#x2019;, then when a browser makes a request for <tt>http://my-machine:8080/public/foo/bar.html</tt>, PokerFace will make a proxy request to <tt>http://new-hotness.mydomain.com/public/foo/bar.html</tt> and return that content.</p></div>
<div class="section">
<h4><a name="old-and-busted"></a>old-and-busted</h4>
<p>You may notice the # (anchor) on the &#x2018;old-and-busted&#x2019; remote target.  This tells PokerFace to strip the first #8 charachters off the beginning of each request <b>before</b> sending it on to that target.  So, when it recieves a request for <tt>http://my-machine:8080/private/bar/foo.html</tt>, it will re-write that and make a proxy request to <tt>http://old-and-busted.mydomain.com/corp/bar/foo.html</tt>.</p></div></div>
<div class="section">
<h3><a name="The_DocumentRoot_challenge."></a><b>The <i>DocumentRoot</i> challenge.</b></h3>
<p><b>If</b> foo.html contains an absolute link to say /assets/my.css, then the <b>browser</b> is going to request <tt>http://my-machine:8080/assets/my.css</tt>.  PokerFace will then return a 404 response (since that does not start with either /public/* or /private/*).</p>
<p>Remember, this DocumentRoot challenge is faced by all reverse proxies. Fortunately, there are solutions:</p>
<ul>

<li>Ensure your html uses relative paths to child resources.  For example, the &#x201c;<a class="externalLink" href="http://old-and-busted.mydomain.com/corp/bar/foo.html">http://old-and-busted.mydomain.com/corp/bar/foo.html</a>&#x201d; link would need to be to ./assets/my.css instead of /assets/my.css.  Be careful with this approach though.  ../assets/my.css will put you right back in the same 404 response boat.</li>
<li>The simplest solution is to add an additional target to the configuration such as: <tt>-target &quot;/assets/*=http://old-and-busted.mydomain.com/assets&quot;</tt></li>
</ul></div>
<div class="section">
<h3><a name="Summary"></a>Summary</h3>
<p>As you can see configuring <b>PokerFace</b> as a reverse proxy is quick and easy.  Additional scenarios such as <a href="./fileserver.html">overriding remote resources</a>, configuring <a href="./httpsconfig.html">https connections</a>, and <a href="./abscripting.html">redirecting requests</a> are just as simple.</p>
<p>If you need more control over the configuration than what can be obtained from the <a href="./cmdlineopts.html">command line</a>, you can switch to using a <a href="./configfile.html">configuration file</a>.</p></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p class="pull-right">Copyright &copy;2015&#x2013;2022
Frank Stock.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
